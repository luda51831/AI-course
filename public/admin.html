<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Додати урок</title>

  <link rel="stylesheet" href="css/fonStyles.css">    
  <link rel="stylesheet" href="css/adminStyles.css">
  <link rel="stylesheet" href="css/navStyles.css">
  <link rel="stylesheet" href="css/navStylesAdmin.css">

</head>
<body>
  <header>
    <div class="logo">AI-курс з нуля</div>
  
    <nav class="nav-links-admin">
      <div class="nav-left">
        <a href="index.html">Головна</a>
        <a href="lessons.html">Уроки</a>
        <a href="homework.html" id="homeworkLink">Домашні завдання</a>
      </div>
  
      <div class="nav-right">
        <a href="admin.html" class="admin-link active" style="color: #58a6ff;">Додати урок</a>
        <a href="adminHomework.html" class="admin-link"style="color: #58a6ff;">Домашні роботи користувачів</a>
        <a href="adminAddUser.html" class="admin-link"style="color: #58a6ff;">Додати користувача</a>
      </div>
    </nav>

    <select id="mobileNav" class="mobile-nav">
      <option value="index.html">Головна</option>
      <option value="lessons.html">Уроки</option>
      <option value="homework.html">Домашні завдання</option>
      <option value="admin.html" style="color: #58a6ff;">Додати урок</option>
      <option value="adminHomework.html" style="color: #58a6ff;">Домашні роботи користувачів</option>
      <option value="adminAddUser.html" style="color: #58a6ff;">Додати користувача</option>
    </select>
    
  </header>

  <h1>Admin: додати урок</h1>
  <div class="lesson-container">
    <div class="lesson-left">
      <form id="lessonForm" enctype="multipart/form-data">
        <h2>Додати урок</h2>
        <label>Номер уроку:</label>
        <input type="number" name="lessonNumber" required>
        <label>Назва:</label>
        <input type="text" name="title" required>
        <label>Опис:</label>
        <textarea name="description"></textarea>
        <label>Мова:</label>
        <select name="language" required style="margin-bottom: 15px;">
          <option value="uk">Українська</option>
          <option value="en">English</option>
        </select><br>
        <label>Відкрити з (число місяця):</label>
        <input type="number" name="openDay" min="1" max="31" required>
        <label>Закрити по (число місяця):</label>
        <input type="number" name="closeDay" min="1" max="31" required>
        <label>Відео:</label>
        <input type="file" name="video" accept="video/*" required>
        <button type="submit">Додати</button>
      </form>
    </div>
  
    <div class="lesson-right">
    
<!-- Фільтр мови -->
<div class="filter-container">
  <label for="filterLanguage">Фільтр за мовою:</label>
  <select id="filterLanguage">
    <option value="all">Всі</option>
    <option value="uk">Українська</option>
    <option value="en">English</option>
  </select>
</div>

<h2>Список доданих уроків</h2>


      <ul id="existing"></ul>
    </div>
    
  </div>
  
  <div id="toastContainer" style="
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 9999;
  align-items: center;
"></div>


<script>
  const API_URL = 'https://ai-course-sm7i.onrender.com/api';
  
  document.addEventListener("DOMContentLoaded", () => {
    const token = localStorage.getItem("token");
    const filterSelect = document.getElementById("filterLanguage");
    let lessonList = [];
  
    async function loadList() {
      try {
        const res = await fetch(`${API_URL}/admin/lessons`, {
          headers: { Authorization: "Bearer " + token }
        });
        if (!res.ok) throw new Error("Помилка сервера: " + res.status);
        lessonList = await res.json();
        renderList();
      } catch (err) {
        console.error("Помилка завантаження:", err);
        showToast("Не вдалося завантажити уроки", "error");
      }
    }
  
    document.getElementById("lessonForm").onsubmit = async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      try {
        const res = await fetch(`${API_URL}/admin/lesson`, {
          method: "POST",
          headers: { Authorization: "Bearer " + token },
          body: fd
        });
        const data = await res.json();
        showToast(data.message || "Урок додано успішно!", "success");
        loadList();
        e.target.reset();
      } catch (err) {
        console.error(err);
        showToast("Помилка при збереженні уроку", "error");
      }
    };
  
    function renderList() {
      const selectedLang = filterSelect.value;
      const filteredList = lessonList.filter(l => selectedLang === "all" || l.language === selectedLang);
  
      document.getElementById("existing").innerHTML = filteredList.map(l => `
        <li>
          <strong>ID:</strong> ${l._id || "—"}<br>
          <strong>Номер уроку:</strong> ${l.lessonNumber || "—"}<br>
          <strong>Назва:</strong> ${l.title}<br>
          <strong>Опис:</strong> ${l.description || "—"}<br>
          <strong>Мова:</strong> ${l.language || "—"}<br>
          <strong>Відкрито з:</strong> ${l.openDay || "—"}<br>
          <strong>Закрито по:</strong> ${l.closeDay || "—"}<br>
          <strong>Відео:</strong> ${l.videoUrl ? `<a href="${API_URL}${l.videoUrl}" target="_blank">Переглянути</a>` : "Немає"}<br>
          <button onclick="deleteLesson('${l._id}')">Видалити</button>
        </li>
      `).join("");
    }
  
    filterSelect.addEventListener("change", renderList);
  
    window.deleteLesson = async (id) => {
      try {
        await fetch(`${API_URL}/admin/lesson/${id}`, {
          method: "DELETE",
          headers: { Authorization: "Bearer " + token }
        });
        loadList();
      } catch (err) {
        console.error(err);
        showToast("Помилка при видаленні уроку", "error");
      }
    };
  
    loadList();
  });  

function showToast(message, type = 'info', duration = 4000) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');

  let bgColor = '#21262d';
  if (type === 'success') bgColor = '#238636';
  else if (type === 'error') bgColor = '#f85149';
  else if (type === 'warning') bgColor = '#e3b341';

  toast.style.background = bgColor;
  toast.style.color = '#c9d1d9';
  toast.style.padding = '10px 15px';
  toast.style.borderRadius = '6px';
  toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.3)';
  toast.style.fontSize = '14px';
  toast.style.fontWeight = '500';
  toast.style.opacity = '0';
  toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
  toast.textContent = message;
  toast.style.whiteSpace = 'nowrap'; 

  container.appendChild(toast);

  // Анімація появи
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
  }, 10);

  // Авто-зникнення
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(-20px)';
    setTimeout(() => container.removeChild(toast), 300);
  }, duration);
}

const mobileNav = document.getElementById('mobileNav');

// шукаємо активне посилання серед обох типів меню
const activeLink =
  document.querySelector('.nav-links a.active') ||
  document.querySelector('.nav-links-admin a.active');

if (activeLink) {
  mobileNav.value = activeLink.getAttribute('href');
}

// при зміні select переходити за посиланням
mobileNav.addEventListener('change', (e) => {
  window.location.href = e.target.value;
});

  </script>
</body>
</html>
