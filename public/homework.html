<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</title>
    <link rel="stylesheet" href="css/fonStyles.css">
    <link rel="stylesheet" href="css/homeworkStyles.css">
    <link rel="stylesheet" href="css/navStyles.css">

</head>
<body>
        <header>
          <div class="logo">AI-–∫—É—Ä—Å –∑ –Ω—É–ª—è</div>
        
          <nav class="nav-links">
            <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="lessons.html">–£—Ä–æ–∫–∏</a>
            <a href="homework.html" id="homeworkLink" class="active">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
            <a href="#" id="profileLink">–ü—Ä–æ—Ñ—ñ–ª—å</a>
          </nav>

          <select id="mobileNav" class="mobile-nav">
            <option value="index.html">–ì–æ–ª–æ–≤–Ω–∞</option>
            <option value="lessons.html">–£—Ä–æ–∫–∏</option>
            <option value="homework.html">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</option>
            <option value="#" id="profileLink">–ü—Ä–æ—Ñ—ñ–ª—å</option>
          </select>

          <div class="user-info">
          <div class="user-email" id="userEmail" style="color: #c9d1d9; font-weight: 500; margin-left: 20px;"></div>
          <select id="languageSelect">
            <option value="uk">üá∫üá¶</option>
            <option value="en">üá¨üáß</option>
          </select>
        </div>

        <div class="notification" id="notificationIcon" title="–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è">
          <img src="../alarm-bell.png" alt="–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è" class="notification-img">
          <span class="badge hidden" id="notificationCount">0</span>
        </div>
          <div id="notificationList" style="display:none; max-width: 400px; position: absolute; top: 50px; right: 20px; background: #161b22; color: #c9d1d9; border: 1px solid #58a6ff; border-radius: 8px; padding: 10px;"></div>
                    
        </header>

        <div id="homework-list"></div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è -->
<div id="confirmModal" class="custom-modal hidden">
  <div class="custom-modal-content">
    <p id="confirmMessage"></p>
    <div class="modal-buttons">
      <button id="confirmYes">‚úÖ –¢–∞–∫</button>
      <button id="confirmNo">‚ùå –ù—ñ</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
<div id="promptModal" class="custom-modal hidden">
  <div class="custom-modal-content">
    <p id="promptMessage"></p>
    <input type="text" id="promptInput" />
    <div class="modal-buttons">
      <button id="promptOk">üíæ OK</button>
      <button id="promptCancel">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
  </div>
</div>

        <div id="toastContainer" style="
        position: fixed;
        flex-direction: column;
        gap: 10px;
        z-index: 9999;
      "></div>

<script src="index.js"></script>
<script src="notification.js"></script>
<script src="language.js"></script>

  
<script>
  document.addEventListener('DOMContentLoaded', () => {
  loadHomework();

  // —Å–ª—É—Ö–∞—î–º–æ –∑–º—ñ–Ω—É –º–æ–≤–∏
  const select = document.getElementById('languageSelect');
  if (select) {
    select.addEventListener('change', () => {
      const lang = select.value;
      localStorage.setItem('language', lang);
      loadHomework();
    });
  }
});


async function loadHomework() {
  const token = localStorage.getItem('token');
  const lang = localStorage.getItem('language') || 'uk';

  if (!token) {
    showToast(lang === 'en' ? 'Please log in' : '–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—è');
    return;
  }

  try {
    const res = await fetch('/api/homework', {
      headers: { Authorization: `Bearer ${token}` }
    });

    const data = await res.json();
    const container = document.getElementById('homework-list');

    if (!Array.isArray(data) || data.length === 0) {
      container.innerHTML = `<p>${lang === 'en' ? 'No homework available' : '–ù–µ–º–∞—î –¥–æ–º–∞—à–Ω—ñ—Ö –∑–∞–≤–¥–∞–Ω—å'}</p>`;
      return;
    }

    container.innerHTML = ''; 

    data.forEach(hw => {
      const div = document.createElement('div');
      div.style.border = '1px solid #ccc';
      div.style.padding = '10px';
      div.style.margin = '10px 0';
      div.style.borderRadius = '6px';
      div.style.background = '#161b22';
      div.style.color = '#c9d1d9';
      div.style.display = 'flex';
      div.style.justifyContent = 'space-between';
      div.style.alignItems = 'center';

      // –õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
      const infoDiv = document.createElement('div');
infoDiv.classList.add('homework-info');

infoDiv.innerHTML = `
  <p><strong>${lang === 'en' ? 'Lesson' : '–£—Ä–æ–∫'} #${hw.lessonNumber}</strong></p>
  <p class="comment">${lang === 'en' ? 'Comment:' : '–ö–æ–º–µ–Ω—Ç–∞—Ä:'} ${hw.comment || (lang === 'en' ? 'No comment' : '–ë–µ–∑ –∫–æ–º–µ–Ω—Ç–∞—Ä—è')}</p>
  <p><a href="/homeworks/${hw.storedFilename}" target="_blank">
    ${lang === 'en' ? 'View file' : '–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ñ–∞–π–ª'}
  </a></p>
  ${hw.adminComment 
    ? `<p class="teacher-response">${lang === 'en' ? 'Teacher response:' : '–í—ñ–¥–ø–æ–≤—ñ–¥—å –≤–∏–∫–ª–∞–¥–∞—á–∞:'} ${hw.adminComment}</p>` 
    : `<p class="pending">${lang === 'en' ? 'Pending review' : '–û—á—ñ–∫—É—î –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É'}</p>`}
`;
div.appendChild(infoDiv);


      // –ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ –∑ –∫–Ω–æ–ø–∫–∞–º–∏
      const buttonsDiv = document.createElement('div');
      buttonsDiv.style.display = 'flex';
      buttonsDiv.style.flexDirection = 'column';
      buttonsDiv.style.gap = '5px';

      const editBtn = document.createElement('button');
      editBtn.textContent = lang === 'en' ? 'Edit' : '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏';
      editBtn.classList.add('edit-btn');
      editBtn.onclick = async () => {
        const newComment = await customPrompt(
  lang === 'en' ? 'Edit comment:' : '–†–µ–¥–∞–≥—É–π—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä',
  hw.comment || ''
);
if (newComment === null) return;
        try {
          const res = await fetch(`/api/homework/${hw._id}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ comment: newComment })
          });

          if (!res.ok) {
            const err = await res.json();
            showToast(err.message || (lang === 'en' ? 'Error editing homework' : '–ü–æ–º–∏–ª–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è'));
            return;
          }

          showToast(lang === 'en' ? 'Comment updated' : '–ö–æ–º–µ–Ω—Ç–∞—Ä –æ–Ω–æ–≤–ª–µ–Ω–æ');
          loadHomework();
        } catch (err) {
          showToast(lang === 'en' ? 'Connection error' : '–ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è');
          console.error(err);
        }
      };
      buttonsDiv.appendChild(editBtn);

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = lang === 'en' ? 'Delete' : '–í–∏–¥–∞–ª–∏—Ç–∏';
      deleteBtn.classList.add('delete-btn');
      deleteBtn.onclick = async () => {

// –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
const confirmDelete = await customConfirm(
  lang === 'en'
    ? 'Are you sure you want to delete this homework?'
    : '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –î–ó?'
);
if (!confirmDelete) return;

  try {
    const res = await fetch(`/api/homework/${hw._id}`, {
      method: 'DELETE',
      headers: { Authorization: `Bearer ${token}` }
    });

    if (res.ok) {
      showToast(
        lang === 'en'
          ? 'Homework deleted successfully'
          : '–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ',
      );
      loadHomework();
    } else {
      showToast(
        lang === 'en'
          ? 'Failed to delete homework'
          : '–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏ –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è',
        'error'
      );
    }
  } catch (err) {
    showToast(
      lang === 'en'
        ? 'Connection error'
        : '–ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è',
      'error'
    );
    console.error(err);
  }
};




      buttonsDiv.appendChild(deleteBtn);

      div.appendChild(buttonsDiv);

      container.appendChild(div);
    });
  } catch (err) {
    console.error(err);
    const container = document.getElementById('homework-list');
    if (container) {
      container.innerHTML = `<p>${lang === 'en' ? 'Error loading homework' : '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–º–∞—à–æ–∫'}</p>`;
    }
  }
}


function showToast(message, type = 'info', duration = 4000) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');

  let bgColor = '#21262d';
  if (type === 'success') bgColor = '#238636';
  else if (type === 'error') bgColor = '#f85149';
  else if (type === 'warning') bgColor = '#e3b341';

  toast.style.background = bgColor;
  toast.style.color = '#c9d1d9';
  toast.style.padding = '10px 15px';
  toast.style.borderRadius = '6px';
  toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.3)';
  toast.style.fontSize = '14px';
  toast.style.fontWeight = '500';
  toast.style.opacity = '0';
  toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
  toast.textContent = message;
  toast.style.whiteSpace = 'nowrap'; 

  container.appendChild(toast);

  // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
  }, 10);

  // –ê–≤—Ç–æ-–∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(-20px)';
    setTimeout(() => container.removeChild(toast), 300);
  }, duration);
}

function updateToastPosition() {
  const container = document.getElementById('toastContainer');
  const scrollY = window.scrollY || window.pageYOffset;
  const viewportHeight = window.innerHeight;

  container.style.position = 'absolute';

  if (scrollY + viewportHeight / 2 < document.body.scrollHeight / 2) {
    container.style.top = (scrollY + 20) + 'px';
    container.style.bottom = 'auto';
  } else {
    container.style.bottom = '20px';
    container.style.top = 'auto';
  }

  container.style.left = '50%';
  container.style.transform = 'translateX(-50%)';
}

function customConfirm(message) {
  return new Promise((resolve) => {
    const modal = document.getElementById('confirmModal');
    const msg = document.getElementById('confirmMessage');
    const yesBtn = document.getElementById('confirmYes');
    const noBtn = document.getElementById('confirmNo');

    msg.textContent = message;
    modal.classList.remove('hidden');

    yesBtn.onclick = () => {
      modal.classList.add('hidden');
      resolve(true);
    };
    noBtn.onclick = () => {
      modal.classList.add('hidden');
      resolve(false);
    };
  });
}

function customPrompt(message, defaultValue = '') {
  return new Promise((resolve) => {
    const modal = document.getElementById('promptModal');
    const msg = document.getElementById('promptMessage');
    const input = document.getElementById('promptInput');
    const okBtn = document.getElementById('promptOk');
    const cancelBtn = document.getElementById('promptCancel');

    msg.textContent = message;
    input.value = defaultValue;
    modal.classList.remove('hidden');

    okBtn.onclick = () => {
      modal.classList.add('hidden');
      resolve(input.value);
    };
    cancelBtn.onclick = () => {
      modal.classList.add('hidden');
      resolve(null);
    };
  });
}


function updateModalLanguage() {
  const lang = localStorage.getItem('language') || 'uk';

  const confirmYes = document.getElementById('confirmYes');
  const confirmNo = document.getElementById('confirmNo');
  const promptOk = document.getElementById('promptOk');
  const promptCancel = document.getElementById('promptCancel');

  if (lang === 'en') {
    if (confirmYes) confirmYes.textContent = '‚úÖ Yes';
    if (confirmNo) confirmNo.textContent = '‚ùå No';
    if (promptOk) promptOk.textContent = 'üíæ OK';
    if (promptCancel) promptCancel.textContent = '‚ùå Cancel';
  } else {
    if (confirmYes) confirmYes.textContent = '‚úÖ –¢–∞–∫';
    if (confirmNo) confirmNo.textContent = '‚ùå –ù—ñ';
    if (promptOk) promptOk.textContent = 'üíæ OK';
    if (promptCancel) promptCancel.textContent = '‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏';
  }
}

// –í–∏–∫–ª–∏–∫–∞—Ç–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
document.addEventListener('DOMContentLoaded', updateModalLanguage);

// –Ü –ø—Ä–∏ –∑–º—ñ–Ω—ñ –º–æ–≤–∏
document.getElementById('languageSelect')?.addEventListener('change', () => {
  localStorage.setItem('language', document.getElementById('languageSelect').value);
  updateModalLanguage();
});


// –í–∏–∫–ª–∏–∫ –ø—Ä–∏ —Å–∫—Ä–æ–ª—ñ
window.addEventListener('scroll', updateToastPosition);
window.addEventListener('resize', updateToastPosition);

// –ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è
updateToastPosition();

// –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π –ø—É–Ω–∫—Ç –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
const mobileNav = document.getElementById('mobileNav');
const activeLink = document.querySelector('.nav-links a.active');
if (activeLink) {
  mobileNav.value = activeLink.getAttribute('href');
}


if (mobileNav) {
  mobileNav.addEventListener('change', (e) => {
    const value = e.target.value;
    const role = localStorage.getItem('role'); // –±–µ—Ä–µ–º–æ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

    if (value === '#') { // —Ü–µ —Ç–≤—ñ–π –ø—É–Ω–∫—Ç "–ü—Ä–æ—Ñ—ñ–ª—å"
      if (role === 'admin') {
        window.location.href = 'admin.html';
      } else {
        window.location.href = 'profile.html';
      }
    } else {
      window.location.href = value;
    }
  });
}

// –ø—Ä–∏ –∑–º—ñ–Ω—ñ select –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
mobileNav.addEventListener('change', (e) => {
  window.location.href = e.target.value;
});
</script>
<script src="index.js"></script>

</body>
</html>