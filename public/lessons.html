<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>AI-–∫—É—Ä—Å –∑ –Ω—É–ª—è</title>
  <link rel="stylesheet" href="css/fonStyles.css">
  <link rel="stylesheet" href="css/lessonsStyles.css">
  <link rel="stylesheet" href="css/navStyles.css">

</head>
<body>

  <header>
    <div class="logo">AI-–∫—É—Ä—Å –∑ –Ω—É–ª—è</div>
  
    <nav class="nav-links">
      <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="lessons.html" class="active">–£—Ä–æ–∫–∏</a>
      <a href="homework.html" id="homeworkLink">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
      <a href="#" id="profileLink">–ü—Ä–æ—Ñ—ñ–ª—å</a>
    </nav>
  
    <select id="mobileNav" class="mobile-nav">
      <option value="index.html">–ì–æ–ª–æ–≤–Ω–∞</option>
      <option value="lessons.html">–£—Ä–æ–∫–∏</option>
      <option value="homework.html">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</option>
      <option value="#" id="profileLink">–ü—Ä–æ—Ñ—ñ–ª—å</option>
    </select>
    
    <div class="user-info">
      <div class="user-email" id="userEmail" style="color: #c9d1d9; font-weight: 500; margin-left: 20px;"></div>
      <select id="languageSelect">
        <option value="uk">üá∫üá¶</option>
        <option value="en">üá¨üáß</option>
      </select>
    </div>

    <script src="index.js"></script>   
    <div class="notification" id="notificationIcon" title="–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è">
      <img src="../alarm-bell.png" alt="–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è" class="notification-img">
      <span class="badge hidden" id="notificationCount">0</span>
    </div>
    <div id="notificationList" style="display:none; max-width: 400px; position: absolute; top: 50px; right: 20px; background: #161b22; color: #c9d1d9; border: 1px solid #58a6ff; border-radius: 8px; padding: 10px;"></div>
              
    </header>

<main>
  <div id="authSection" class="auth">
    <h2>–í—Ö—ñ–¥ / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
    <div id="errorMsg" class="error"></div>
    <input type="email" id="emailInput" placeholder="Email" required />
    <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å" required />
    <button id="loginBtn">–£–≤—ñ–π—Ç–∏</button>
    <button id="registerBtn">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</button>
  </div>

  <div id="appSection" class="hidden">


    <div class="content-container" style="display: flex; gap: 20px; align-items: flex-start;">
  
      <!-- –õ—ñ–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ (–≤—ñ–¥–µ–æ + –ø—Ä–æ–≥—Ä–µ—Å) -->
      <div class="left-side" style="flex: 2;">
        <div id="videoSection"></div>
        <div id="progressSection" style="margin-top: 10px;"></div>
      </div>
    
      <!-- –ü—Ä–∞–≤–∞ —á–∞—Å—Ç–∏–Ω–∞ (—Å–ø–∏—Å–æ–∫ —É—Ä–æ–∫—ñ–≤) -->
      <div class="right-side" style="flex: 1; border-radius:10px; padding:10px;">
        <h3 id="lessonsTitle" style="color:#58a6ff;">
          <img src="../lesson.png" alt="–£—Ä–æ–∫–∏" class="notification-img"> –£—Ä–æ–∫–∏
        </h3>
        
        <div class="lesson-list" id="lessonList"></div>


      </div>
    
    </div>
    
    

    <div id="homeworkUpload" style="margin-top: 30px;">
      <h3>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è</h3>
      <form id="homeworkForm" enctype="multipart/form-data">
        <div 
        id="dropZone"
        style="border: 2px dashed #58a6ff; padding: 20px; text-align: center; border-radius: 10px; cursor: pointer; background-color: #161b22;">
        –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª —Å—é–¥–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É
        
        <input type="file" name="file" id="homeworkFile" style="display:none;" required>

      </div>
      
        <textarea name="comment" id="homeworkText" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä –¥–æ –¥–æ–º–∞—à–Ω—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è" style="margin-top:10px;width:100%;height:60px;background:#0d1117;color:#c9d1d9;border:none;padding:8px;border-radius:5px;"></textarea>
        <button type="submit" class="btn-submit">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
        <div id="uploadedHomework" style="margin-top: 10px;"></div>

        <div id="homework-list" style="margin-top: 10px;"></div>
      </form>
    </div>
    
  </div>
</main>

<div id="toastContainer" style="
  position: fixed;
  flex-direction: column;
  gap: 10px;
  z-index: 9999;
"></div>



<script src="index.js"></script>

<script>
  const API_URL = 'https://ai-course-sm7i.onrender.com/api';

  const lessonList = document.getElementById('lessonList');
  const videoSection = document.getElementById('videoSection');
  const progressSection = document.getElementById('progressSection');
  const homeworkComment = document.getElementById('homeworkComment');

  const notificationCount = document.getElementById('notificationCount');

  let token = localStorage.getItem('token');
  let lessons = [];
  let selectedLesson = null;
  let userProgress = {};

  function showError(msg) {
    errorMsg.textContent = msg;
  }

  function clearError() {
    errorMsg.textContent = '';
  }

  function setAuth(tokenStr, user = null) {
  token = tokenStr;
  localStorage.setItem('token', token);

  if (user && user.id) {
    localStorage.setItem('userId', user.id);
  }

  authSection.classList.add('hidden');
  appSection.classList.remove('hidden');
  loadLessons();
}



  function showUploadedHomework(filename, comment) {
  const container = document.getElementById('uploadedHomework');
  container.innerHTML = `
    <div style="background:#21262d;padding:10px;border-radius:6px;">
      <strong>–í–∞—à–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–µ –î–ó:</strong><br>
      <a href="${API_URL}/uploads/${filename}" target="_blank" style="color:#58a6ff;">üìé ${filename}</a>
      ${comment ? `<div style="margin-top:5px;font-style:italic;color:#8b949e;">${comment}</div>` : ''}
    </div>
  `;
}

  async function apiRequest(path, method='GET', body=null) {
    const headers = {'Content-Type': 'application/json'};
    if (token) headers['Authorization'] = 'Bearer ' + token;
    const res = await fetch(API_URL + path, {
      method,
      headers,
      body: body ? JSON.stringify(body) : null,
    });
    if (res.status === 401 || res.status === 403) {
      logout();
      throw new Error('–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø');
    }
    return res.json();
  }
  async function loadProgress() {
  try {
    const lang = localStorage.getItem('language') || 'uk';
    const res = await apiRequest(`/profile/progress?lang=${lang}`);

    console.log('–ü—Ä–æ–≥—Ä–µ—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:', res);

    userProgress = res[lang]?.progress || {};
  } catch (err) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É:', err);
    throw err;
  }
}



  const languageSelect = document.getElementById('languageSelect');

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É—Ä–æ–∫—ñ–≤ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –º–æ–≤–∏
async function loadLessons() {
  try {
    let lang = localStorage.getItem('language') || languageSelect.value;

    languageSelect.value = lang;
    localStorage.setItem('language', lang);

    console.log('–ü–æ—Ç–æ—á–Ω–∞ –º–æ–≤–∞:', lang);

    // –û—Ç—Ä–∏–º—É—î–º–æ —É—Ä–æ–∫–∏ –∑ –±–µ–∫–µ–Ω–¥—É
    const allLessons = await apiRequest(`/lessons?lang=${lang}`);
    console.log('allLessons –∑ –±–µ–∫–µ–Ω–¥—É:', allLessons);

    if (Array.isArray(allLessons)) {
      lessons = allLessons;
    } else if (allLessons.lessons && Array.isArray(allLessons.lessons)) {
      lessons = allLessons.lessons;
    } else {
      lessons = [];
    }

    await loadProgress();
    renderLessons();

    // üü¢ –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –≤–∏–±—Ä–∞–Ω–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–∏—Ä–∞—î–º–æ —É—Ä–æ–∫ –∑ –Ω–∞–π–º–µ–Ω—à–∏–º lessonNumber
    if (!selectedLesson && lessons.length > 0) {
      const openLessons = lessons.filter(l => l.isOpen ?? true);
      if (openLessons.length > 0) {
        const firstLesson = openLessons.reduce((min, l) => {
          const num = l.lessonNumber ?? l.lessonId ?? Infinity;
          return num < (min.lessonNumber ?? min.lessonId ?? Infinity) ? l : min;
        }, openLessons[0]);

        selectLesson(firstLesson);
      }
    }

  } catch (e) {
    showError(e.message);
  }
}






// –û–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ –º–æ–≤–∏
languageSelect.addEventListener('change', async () => {
  const lang = languageSelect.value;
  localStorage.setItem('language', lang);

  // üü¢ —Å–∫–∏–¥–∞—î–º–æ –≤–∏–±—Ä–∞–Ω–∏–π —É—Ä–æ–∫
  selectedLesson = null;
  videoSection.innerHTML = '';
  progressSection.innerHTML = '';

  await loadLessons();
});


// –†–µ–Ω–¥–µ—Ä —É—Ä–æ–∫—ñ–≤
function renderLessons() {
  lessonList.innerHTML = '';
  const lang = localStorage.getItem('language');
  const lessonLabel = lang === 'en' ? 'Lesson' : '–£—Ä–æ–∫';

  lessons.forEach((lesson, i) => {
    const number = lesson.lessonNumber || lesson.lessonId || i + 1;
    const lessonProgress = userProgress[number.toString()] || 0;

    const div = document.createElement('div');
    div.className = 'lesson-item';

    const isOpen = lesson.isOpen ?? true;

    div.style.transition = 'border 0.3s ease, box-shadow 0.3s ease';

    if (selectedLesson && selectedLesson.lessonNumber === number) {
      div.style.backgroundColor = '#0d0f12';
      div.style.color = 'white'; 
      div.style.border = '2px solid #1f6feb';
  div.style.borderRadius = '8px';
  div.style.padding = '8px';
  div.style.boxShadow = '0 0 10px rgba(31, 111, 235, 0.5)';
  
    } else {
      div.style.backgroundColor = '#21262d';
      div.style.color = '#c9d1d9';
      div.style.border = 'none';
  div.style.boxShadow = 'none';
    }

    div.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          ${lessonLabel} ${number}. <strong>${lesson.title}</strong>
          ${lesson.description ? `<div style="margin-top: 4px; font-size: 13px; color: #8b949e;">${lesson.description}</div>` : ''}
        </div>
        <div style="margin-left: 10px; color: #58a6ff; font-weight: bold;">
          ${lessonProgress}%
        </div>
      </div>
    `;

    if (isOpen) {
      div.style.cursor = 'pointer';
      div.onclick = () => {
        selectedLesson = lesson;
        renderLessons();
        selectLesson(lesson);
      };
    } else {
      div.style.opacity = 0.5;
      div.style.cursor = 'not-allowed';
      div.innerHTML += ` <span style="color:red;">üîí</span>`;
    }

    lessonList.appendChild(div);
  });
}



async function selectLesson(lesson) {
  selectedLesson = lesson;
  renderLessons();
  clearError();

  
// –í—ñ–¥–µ–æ
videoSection.innerHTML = `
  <div class="lesson-title-search">
    <span class="lesson-title-left" id="lessonTitle"></span>
<span class="lesson-title-right">
  <img src="../search.png" alt="Search" style="width:20px; height:20px;">
</span>
  </div>
  <video id="lessonVideo" controls controlsList="nodownload" oncontextmenu="return false" preload="metadata">
    <source src="${lesson.videoUrl}" type="video/mp4">
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥–µ–æ.
  </video>
`;

typeWriter('lessonTitle', lesson.title);




// üü¢ –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å —É –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ
function linkify(text) {
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  return text.replace(urlRegex, url => {
    return `<a href="${url}" target="_blank" style="color:#58a6ff; text-decoration:underline;">${url}</a>`;
  });
}

const lang = localStorage.getItem('language') || 'uk';
const descriptionLabel = lang === 'en' ? 'Description' : '–û–ø–∏—Å';

if (lesson.description) {
  videoSection.insertAdjacentHTML('beforeend', `
    <div style="margin-top:15px; padding:10px; background:#21262d; border-radius:6px;">
      <strong>${descriptionLabel}:</strong><br>
      ${linkify(lesson.description)}
    </div>
  `);
}




  const video = document.getElementById('lessonVideo');
  const progressBarHTML = `
    <div class="progress-container" style="width: 100%; background: #444; border-radius: 4px; height: 10px; margin-top: 10px;">
      <div class="progress-bar" id="progressBar" style="height: 100%; width: 0; background: #58a6ff; border-radius: 4px;"></div>
    </div>
  `;
  progressSection.innerHTML = progressBarHTML;
  const progressBar = document.getElementById('progressBar');


  // –û—Ç—Ä–∏–º—É—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –∑ localStorage —Ç–∞ –∑ –±–µ–∫–µ–Ω–¥—É
  const lessonNumberStr = lesson.lessonNumber ? lesson.lessonNumber.toString() : '';
const savedProgress = userProgress[lessonNumberStr] ?? 0;
let lastSavedPercent = savedProgress;


  // –û—á–∏—â–∞—î–º–æ —Å—Ç–∞—Ä—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏, —è–∫—â–æ —î
  if (video._loadedmetadataHandler) video.removeEventListener('loadedmetadata', video._loadedmetadataHandler);
  if (video._timeupdateHandler) video.removeEventListener('timeupdate', video._timeupdateHandler);
  if (video._endedHandler) video.removeEventListener('ended', video._endedHandler);

  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö
  video._loadedmetadataHandler = () => {
    if (video.duration && savedProgress > 0) {
      const resumeTime = (savedProgress / 100) * video.duration;
      video.currentTime = resumeTime;
    }
  };
  video.addEventListener('loadedmetadata', video._loadedmetadataHandler);

  let lastTime = 0;

  // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –∫–æ–∂–Ω—ñ 5%
  video._timeupdateHandler = async () => {
    if (video.currentTime < lastTime) {
      video.currentTime = lastTime;
      return;
    }
    lastTime = video.currentTime;

    const percent = Math.floor((video.currentTime / video.duration) * 100);
    progressBar.style.width = percent + '%';

    if (percent >= lastSavedPercent + 5 && percent < 100) {
      lastSavedPercent = percent;
      
      if (lesson.lessonNumber) {
        await updateProgress(lesson.lessonNumber, percent);
      }
    }
  };
  video.addEventListener('timeupdate', video._timeupdateHandler);

  video._endedHandler = async () => {
  const percent = 100;

  progressBar.style.width = '100%';

  if (lesson.lessonNumber) {
    await updateProgress(lesson.lessonNumber, percent);

    // üü¢ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ localStorage —Ç–∞ userProgress
    const key = 'progress_' + lesson.lessonNumber;
    localStorage.setItem(key, percent.toString());
    userProgress[lesson.lessonNumber.toString()] = percent;
  }
  const lang = localStorage.getItem('language') || 'uk';
showToast(lang === 'en' ? 'The video has been fully watched!' : '–í—ñ–¥–µ–æ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–æ –ø–æ–≤–Ω—ñ—Å—Ç—é!');
};

video.addEventListener('ended', video._endedHandler);


}





async function updateProgress(lessonNumber, percent) {
  try {
    console.log('–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—É:', lessonNumber, percent);
    await apiRequest('/progress', 'POST', { lessonNumber, percent });

    const progressCheck = await apiRequest('/progress');
    console.log('–ü—Ä–æ–≥—Ä–µ—Å –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:', progressCheck[lessonNumber]);

    const key = 'progress_' + lessonNumber;
    localStorage.setItem(key, percent.toString());
    userProgress[lessonNumber.toString()] = percent;
  } catch (e) {
    showError('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å');
  }
}







  async function loadHomework(lessonNumber) {
  try {
    const currentUserId = localStorage.getItem('userId');
    const res = await fetch(`${API_URL}/homework/${lessonNumber}`, {
      headers: { Authorization: 'Bearer ' + token }
    });

    const container = document.getElementById('homework-list');

    if (!res.ok) {
      container.innerHTML = '<div style="color:#8b949e;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –î–ó</div>';
      return;
    }

    const homeworks = await res.json();
    container.innerHTML = '';

    if (!homeworks || homeworks.length === 0) {
      container.innerHTML = '<div style="color:#8b949e;">–ù–µ–º–∞—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–≥–æ –î–ó –¥–ª—è —Ü—å–æ–≥–æ —É—Ä–æ–∫—É</div>';
      return;
    }

    // –†–µ–Ω–¥–µ—Ä–∏–º–æ —Å–ø–∏—Å–æ–∫ –î–ó
    homeworks.forEach(hw => {
  const id = hw.id || hw._id;
  const commentEscaped = hw.comment ? hw.comment.replace(/'/g, "\\'") : '';

  const div = document.createElement('div');
  div.style.background = hw.userId === currentUserId ? '#1f6feb' : '#21262d';
  div.style.padding = '10px';
  div.style.borderRadius = '6px';
  div.style.marginBottom = '8px';

  const lang = localStorage.getItem('language') || 'uk';
  const lessonLabel = lang === 'en' ? 'Lesson' : '–£—Ä–æ–∫';
  const userLabel = lang === 'en' ? 'Your submitted homework:' : '–í–∞—à–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–µ –î–ó:';
  const userComment = lang === 'en' ? 'Your —Åomment on the homework: ' : '–í–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä –¥–æ –î–ó: ';

  div.innerHTML = `
    <div style="font-weight:bold; margin-bottom:5px; color:#58a6ff;">${userLabel}</div>
    <strong>${lessonLabel} ${hw.lessonNumber}</strong><br>
    <a href="/homeworks/${hw.storedFilename}" target="_blank" style="color:#58a6ff;">
      üìé ${hw.filename}
    </a>
    ${hw.comment ? `<div style="font-style:italic;color:#8b949e;margin-top:4px;">${userComment}${hw.comment}</div>` : ''}
  `;

  container.appendChild(div);
});


  } catch (e) {
    console.error(e);
    document.getElementById('homework-list').innerHTML = '<div style="color:#8b949e;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>';
  }
}






const homeworkForm = document.getElementById('homeworkForm');
const homeworkFile = document.getElementById('homeworkFile');
const dropZone = document.getElementById('dropZone');
const homeworkText = document.getElementById('homeworkText');

dropZone.addEventListener('click', () => {
  homeworkFile.click();
});

homeworkFile.addEventListener('change', () => {
  if (homeworkFile.files.length > 0) {
    dropZone.textContent = `üìé ${homeworkFile.files[0].name}`;
  }
});

dropZone.addEventListener('dragover', e => {
  e.preventDefault();
  dropZone.style.backgroundColor = '#21262d';
});

dropZone.addEventListener('dragleave', () => {
  dropZone.style.backgroundColor = '#161b22';
});

dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.style.backgroundColor = '#161b22';
  homeworkFile.files = e.dataTransfer.files;
});

homeworkForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const language = localStorage.getItem('language') || languageSelect.value;

  if (!selectedLesson)
  return showToast(lang === 'en' ? 'Lesson not selected' : '–£—Ä–æ–∫ –Ω–µ –≤–∏–±—Ä–∞–Ω–æ');

if (!homeworkFile.files.length)
  return showToast(lang === 'en' ? 'Please select a file' : '–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª');

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –≤–∂–µ —î –î–ó –¥–ª—è —Ü—å–æ–≥–æ —É—Ä–æ–∫—É
  try {
    const checkRes = await fetch(`${API_URL}/homework/${selectedLesson.lessonNumber}`, {
      headers: { Authorization: 'Bearer ' + localStorage.getItem('token') }
    });

    const existingHomework = await checkRes.json();

    if (existingHomework && existingHomework.length > 0) {
      return showToast(
  language === 'en'
    ? 'You already have a homework submission for this lesson. To upload a new one, please delete the previous file first.'
    : '–£ –≤–∞—Å –≤–∂–µ —î –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Ü—å–æ–≥–æ —É—Ä–æ–∫—É. –©–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤–µ, —Å–ø–µ—Ä—à—É –≤–∏–¥–∞–ª—ñ—Ç—å —Å—Ç–∞—Ä–µ.'
);
    }
  } catch (err) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —ñ—Å–Ω—É—é—á–æ–≥–æ –î–ó:', err);
    return showToast(
  language === 'en'
    ? 'Failed to check existing homework.'
    : '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ—Å–Ω—É—é—á–µ –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è.'
);
  }

  // –Ø–∫—â–æ –î–ó –Ω–µ–º–∞—î ‚Äì –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏
  const formData = new FormData();
  formData.append('file', homeworkFile.files[0]);
  formData.append('comment', homeworkText.value.trim());
  formData.append('lessonNumber', selectedLesson.lessonNumber);
  formData.append('language', languageSelect.value);

  try {
    const token = localStorage.getItem('token');
    const res = await fetch(`${API_URL}/homework`, {
      method: 'POST',
      headers: { Authorization: 'Bearer ' + token },
      body: formData
    });

    if (!res.ok) {
      const err = await res.json();
      return showToast(
  language === 'en'
    ? err.message || 'Error while sending.'
    : err.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ.'
);
    }

    showToast(
  language === 'en'
    ? 'Homework sent successfully!'
    : '–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!'
);

    homeworkFile.value = '';
    homeworkText.value = '';
    updateDropZoneText(); 

    loadHomework(selectedLesson.lessonNumber);

  } catch (err) {
    showToast(
  language === 'en'
    ? 'Connection error with the server'
    : '–ü–æ–º–∏–ª–∫–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º'
);
    console.error(err);
  }
});

function typeWriter(elementId, text, speed = 100, cursorSpeed = 300) {
  const el = document.getElementById(elementId);
  el.textContent = ''; 
  let i = 0;
  let cursorVisible = true;

  // –ú–∏–≥–∞—é—á–∏–π –∫—É—Ä—Å–æ—Ä
  const cursorInterval = setInterval(() => {
    if (i >= text.length) {
      el.textContent = text + (cursorVisible ? '|' : '');
      cursorVisible = !cursorVisible;
    }
  }, cursorSpeed);

  // –î—Ä—É–∫—É—î–º–æ —Ç–µ–∫—Å—Ç –ø–æ –æ–¥–Ω—ñ–π –ª—ñ—Ç–µ—Ä—ñ
  const typingInterval = setInterval(() => {
    if (i < text.length) {
      el.textContent = text.substring(0, i + 1) + '|';
      i++;
    } else {
      clearInterval(typingInterval);
    }
  }, speed);
}




document.getElementById('appSection').classList.remove('hidden');




  // –ó–∞–ø—É—Å–∫
  if (token) {
    authSection.classList.add('hidden');
    appSection.classList.remove('hidden');
    loadLessons();
  }
 

  
  function showToast(message, type = 'info', duration = 4000) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');

  // –ö–æ–ª—ñ—Ä –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É
  let bgColor = '#21262d';
  if (type === 'success') bgColor = '#238636';
  else if (type === 'error') bgColor = '#f85149';
  else if (type === 'warning') bgColor = '#e3b341';

  toast.style.background = bgColor;
  toast.style.color = '#c9d1d9';
  toast.style.padding = '10px 15px';
  toast.style.borderRadius = '6px';
  toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.3)';
  toast.style.fontSize = '14px';
  toast.style.fontWeight = '500';
  toast.style.opacity = '0';
  toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
  toast.textContent = message;
  toast.style.whiteSpace = 'nowrap'; 

  container.appendChild(toast);

  // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
  }, 10);

  // –ê–≤—Ç–æ-–∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(-20px)';
    setTimeout(() => container.removeChild(toast), 300);
  }, duration);
}

function updateToastPosition() {
  const container = document.getElementById('toastContainer');
  const scrollY = window.scrollY || window.pageYOffset;
  const viewportHeight = window.innerHeight;

  container.style.position = 'absolute';

  if (scrollY + viewportHeight / 2 < document.body.scrollHeight / 2) {
    container.style.top = (scrollY + 20) + 'px';
    container.style.bottom = 'auto';
  } else {
    container.style.bottom = '20px';
    container.style.top = 'auto';
  }

  container.style.left = '50%';
  container.style.transform = 'translateX(-50%)';
}


// –í–∏–∫–ª–∏–∫ –ø—Ä–∏ —Å–∫—Ä–æ–ª—ñ
window.addEventListener('scroll', updateToastPosition);
window.addEventListener('resize', updateToastPosition);

function updateDropZoneText() {
  const lang = localStorage.getItem('language');
  const dropZone = document.getElementById('dropZone');

  if (dropZone) {
    const defaultText = lang === 'en'
      ? 'Drag your file here or click to select'
      : '–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª —Å—é–¥–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É';

    if (!homeworkFile.files.length) {
      dropZone.textContent = defaultText;
    }
  }
}

updateDropZoneText();

languageSelect.addEventListener('change', updateDropZoneText);

updateToastPosition();

function updateLessonsTitle() {
  const lang = localStorage.getItem('language') || 'uk';
  const lessonsTitle = document.getElementById('lessonsTitle');
  
  if (lessonsTitle) {
    lessonsTitle.innerHTML =
      lang === 'en'
        ? '<img src="../lesson.png" alt="Lessons" class="notification-img"> Lessons'
        : '<img src="../lesson.png" alt="–£—Ä–æ–∫–∏" class="notification-img"> –£—Ä–æ–∫–∏';
  }
}

document.addEventListener('DOMContentLoaded', updateLessonsTitle);

document.getElementById('languageSelect')?.addEventListener('change', () => {
  localStorage.setItem('language', document.getElementById('languageSelect').value);
  updateLessonsTitle();
});

    
// –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π –ø—É–Ω–∫—Ç –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
const mobileNav = document.getElementById('mobileNav');
const activeLink = document.querySelector('.nav-links a.active');
if (activeLink) {
  mobileNav.value = activeLink.getAttribute('href');
}


if (mobileNav) {
  mobileNav.addEventListener('change', (e) => {
    const value = e.target.value;
    const role = localStorage.getItem('role'); // –±–µ—Ä–µ–º–æ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

    if (value === '#') { // —Ü–µ —Ç–≤—ñ–π –ø—É–Ω–∫—Ç "–ü—Ä–æ—Ñ—ñ–ª—å"
      if (role === 'admin') {
        window.location.href = 'admin.html';
      } else {
        window.location.href = 'profile.html';
      }
    } else {
      window.location.href = value;
    }
  });
}

// –ø—Ä–∏ –∑–º—ñ–Ω—ñ select –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
mobileNav.addEventListener('change', (e) => {
  window.location.href = e.target.value;
});

</script>
<script src="language.js"></script>
<script src="notification.js"></script>


</body>
</html>
