<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="css/fonStyles.css">    
  <link rel="stylesheet" href="css/adminHomework.css">
  <link rel="stylesheet" href="css/navStyles.css">
  <link rel="stylesheet" href="css/navStylesAdmin.css">

  <title>–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</title>
</head>

<body>
  <header>
    <div class="logo">AI-–∫—É—Ä—Å –∑ –Ω—É–ª—è</div>
  
    <nav class="nav-links-admin">
      <div class="nav-left">
        <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="lessons.html">–£—Ä–æ–∫–∏</a>
        <a href="homework.html" id="homeworkLink">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
      </div>
  
      <div class="nav-right">
        <a href="admin.html" class="admin-link" style="color: #58a6ff;">–î–æ–¥–∞—Ç–∏ —É—Ä–æ–∫</a>
        <a href="adminHomework.html" class="admin-link active"style="color: #58a6ff;">–î–æ–º–∞—à–Ω—ñ —Ä–æ–±–æ—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</a>
        <a href="adminAddUser.html" class="admin-link"style="color: #58a6ff;">–î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a>
      </div>
    </nav>

    <select id="mobileNav" class="mobile-nav">
      <option value="index.html">–ì–æ–ª–æ–≤–Ω–∞</option>
      <option value="lessons.html">–£—Ä–æ–∫–∏</option>
      <option value="homework.html">–î–æ–º–∞—à–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è</option>
      <option value="admin.html" style="color: #58a6ff;">–î–æ–¥–∞—Ç–∏ —É—Ä–æ–∫</option>
      <option value="adminHomework.html" style="color: #58a6ff;">–î–æ–º–∞—à–Ω—ñ —Ä–æ–±–æ—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</option>
      <option value="adminAddUser.html" style="color: #58a6ff;">–î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</option>
    </select>

  </header>
  

  <div class="filter-container">
    <label for="langFilter">–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞ –º–æ–≤–æ—é:</label>
    <select id="langFilter">
      <option value="all">–í—Å—ñ</option>
      <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
      <option value="en">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞</option>
    </select>
  </div>
  

  <div id="homework-list"></div>
</div>

<div id="toastContainer" style="
position: fixed;
top: 20px;
left: 50%;
transform: translateX(-50%);
display: flex;
flex-direction: column;
gap: 10px;
z-index: 9999;
align-items: center;
"></div>

  <script>
    async function loadHomework() {
      const langFilter = document.getElementById('langFilter').value;
      const res = await fetch('https://ai-course-2ek1.onrender.com/api/admin/homework', {
        headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
      });
  
      let homeworks = await res.json();
  
      if (langFilter !== 'all') {
        homeworks = homeworks.filter(hw => hw.language === langFilter);
      }
  
      await renderHomeworkList(homeworks);
    }
  
    async function renderHomeworkList(homeworks) {
      const container = document.getElementById('homework-list');
      container.innerHTML = '';
  
      if (homeworks.length === 0) {
        container.innerHTML = '<p">–ù–µ–º–∞—î –¥–æ–º–∞—à–Ω—ñ—Ö —Ä–æ–±—ñ—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</p>';
        return;
      }
  
      for (const hw of homeworks) {

        // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        let user = null;
        try {
          const res = await fetch(`https://ai-course-2ek1.onrender.com/api/users/${hw.userEmail}`, {
            headers: { 'Authorization': 'Bearer ' + localStorage.getItem('token') }
          });
          if (res.ok) user = await res.json();
        } catch (err) {
          console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞', hw.userEmail, err);
        }
  
        const avatar = user?.avatarUrl || 'https://www.gravatar.com/avatar/?d=identicon&s=50';
        const name = user?.name || hw.userEmail;
  
        const div = document.createElement('div');
        div.className = 'homework-item';
        div.innerHTML = `
          <img src="${avatar}" alt="–§–æ—Ç–æ ${name}" class="user-avatar" width="50" height="50"
               style="border-radius:50%;margin-right:10px;">
          <p><strong>–£—Ä–æ–∫ ‚Ññ:</strong> ${hw.lessonNumber} (${hw.language?.toUpperCase() || '‚Äî'})</p>
          <p><strong>–ù–∞–∑–≤–∞ —É—Ä–æ–∫—É:</strong> ${hw.lessonTitle || '‚Äî'}</p>
          <p><strong>–ú–æ–≤–∞:</strong> ${hw.language}</p>

          <p><strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong> ${name}</p>
          <p><strong>–§–∞–π–ª:</strong> <a href="/uploads/homeworks/${hw.storedFilename}" target="_blank">${hw.filename}</a></p>
          <p><strong>–ö–æ–º–µ–Ω—Ç–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</strong> ${hw.comment || '-'}</p>
          <p><strong>–ö–æ–º–µ–Ω—Ç–∞—Ä –∞–¥–º—ñ–Ω–∞:</strong> ${hw.adminComment || '-'}</p>
          <textarea placeholder="–í–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä..." data-id="${hw._id}">${hw.adminComment || ''}</textarea>
          <button onclick="saveAdminComment('${hw._id}')">  <img src="../safe-delivery.png" alt="safe" style="width:15px; height:15px;"> –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
          <hr>
        `;
        container.appendChild(div);
      }
    }
  
    function saveAdminComment(id) {
      const textarea = document.querySelector(`textarea[data-id="${id}"]`);
      const comment = textarea.value;
  
      fetch(`https://ai-course-2ek1.onrender.com/api/admin/homework/${id}/comment`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('token')
        },
        body: JSON.stringify({ adminComment: comment })
      })
        .then(res => res.json())
        .then(() => {
          showToast('üíæ –ö–æ–º–µ–Ω—Ç–∞—Ä –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
          loadHomework();
        })
        .catch(err => {
          console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ:', err);
          showToast('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ');
        });
    }
  
    document.getElementById('langFilter').addEventListener('change', loadHomework);
    document.addEventListener('DOMContentLoaded', loadHomework);

function showToast(message, type = 'info', duration = 4000) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');

  let bgColor = '#21262d';
  if (type === 'success') bgColor = '#238636';
  else if (type === 'error') bgColor = '#f85149';
  else if (type === 'warning') bgColor = '#e3b341';

  toast.style.background = bgColor;
  toast.style.color = '#c9d1d9';
  toast.style.padding = '10px 15px';
  toast.style.borderRadius = '6px';
  toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.3)';
  toast.style.fontSize = '14px';
  toast.style.fontWeight = '500';
  toast.style.opacity = '0';
  toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
  toast.textContent = message;
  toast.style.whiteSpace = 'nowrap'; 

  container.appendChild(toast);

  // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
  setTimeout(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
  }, 10);

  // –ê–≤—Ç–æ-–∑–Ω–∏–∫–Ω–µ–Ω–Ω—è
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(-20px)';
    setTimeout(() => container.removeChild(toast), 300);
  }, duration);
}

const mobileNav = document.getElementById('mobileNav');

// —à—É–∫–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Å–µ—Ä–µ–¥ –æ–±–æ—Ö —Ç–∏–ø—ñ–≤ –º–µ–Ω—é
const activeLink =
  document.querySelector('.nav-links a.active') ||
  document.querySelector('.nav-links-admin a.active');

if (activeLink) {
  mobileNav.value = activeLink.getAttribute('href');
}

// –ø—Ä–∏ –∑–º—ñ–Ω—ñ select –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
mobileNav.addEventListener('change', (e) => {
  window.location.href = e.target.value;
});
  </script>

</body>
</html>
