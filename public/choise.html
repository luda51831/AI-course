<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–í—Ö—ñ–¥ / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="css/fonStyles.css">
  <link rel="stylesheet" href="css/choiseStyle.css">

</head>
<body>
  <div id="languageSelection" class="language-selection">
    <h2>–û–±–µ—Ä—ñ—Ç—å –º–æ–≤—É / Choose language</h2>
    <button onclick="setLanguage('uk')">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
    <button onclick="setLanguage('en')">üá¨üáß English</button>
  </div>
  
  <div class="auth" id="authForm" style="display:none;">
    <h2 id="authTitle">–í—Ö—ñ–¥</h2>
    <div id="errorMsg" class="error"></div>
    <input type="email" id="emailInput" placeholder="Email" required />
    <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å" required />
    <button id="loginBtn">–£–≤—ñ–π—Ç–∏</button>
  </div>
  


  <script>
const API_URL = 'https://ai-course-sm7i.onrender.com/api';

    function showError(msg, el = 'errorMsg') {
      document.getElementById(el).textContent = msg;
    }

    function updateFileName() {
  const input = document.getElementById('regPhoto');
  const fileName = input.files[0] ? input.files[0].name : translations[localStorage.getItem('language')].regNoFile;
  document.getElementById('fileName').textContent = fileName;
}
    const translations = {
  uk: {
    authTitle: "–í—Ö—ñ–¥",
    emailPlaceholder: "Email",
    passwordPlaceholder: "–ü–∞—Ä–æ–ª—å",
    loginBtn: "–£–≤—ñ–π—Ç–∏",
    registerLink: "–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è",
    registerTitle: "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è",
    registerBtn: "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è",
    regName: "–Ü–º'—è",
    regEmail:"Email",
    regPhoto: "–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª",
    regNoFile: "–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ",
    regPassword: "–ü–∞—Ä–æ–ª—å",
    regConfirm: "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –ø–∞—Ä–æ–ª—å",
  },
  en: {
    authTitle: "Login",
    emailPlaceholder: "Email",
    passwordPlaceholder: "Password",
    loginBtn: "Login",
    registerLink: "No account? Register",
    registerTitle: "Registration",
    registerBtn: "Register",
    regName: "Name",
    regEmail:"Email",
    regPhoto: "Select a file",
    regNoFile: "No file chosen",
    regPassword: "Password",
    regConfirm: "Return password",
  }
};

function setLanguage(lang) {
  localStorage.setItem('language', lang);
  document.getElementById('languageSelection').style.display = 'none';
  document.getElementById('authForm').style.display = 'block';
  applyLanguage(lang);
}

function applyLanguage(lang) {
  document.getElementById('authTitle').textContent = translations[lang].authTitle;
  document.getElementById('emailInput').placeholder = translations[lang].emailPlaceholder;
  document.getElementById('passwordInput').placeholder = translations[lang].passwordPlaceholder;
  document.getElementById('loginBtn').textContent = translations[lang].loginBtn;
  
 

  // –ö–∞—Å—Ç–æ–º–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Ñ–∞–π–ª—É
  document.getElementById('fileBtn').textContent = translations[lang].regPhoto;

  // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
  const registerTitle = document.querySelector('#registerModal h2');
  const registerSubmitBtn = document.querySelector('#registerModal button[onclick="handleRegister()"]');
  if(registerTitle) registerTitle.textContent = translations[lang].registerTitle;
  if(registerSubmitBtn) registerSubmitBtn.textContent = translations[lang].registerBtn;

  updateFileName();
}


window.addEventListener('DOMContentLoaded', () => {
  document.getElementById('languageSelection').style.display = 'block';
  document.getElementById('authForm').style.display = 'none';
});


    async function apiRequest(path, method = 'GET', body = null, isForm = false) {
      const headers = isForm ? {} : { 'Content-Type': 'application/json' };
      const res = await fetch(API_URL + path, {
        method,
        headers,
        body: isForm ? body : JSON.stringify(body),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || '–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É');
      return data;
    }

    // –í—Ö—ñ–¥
    document.getElementById('loginBtn').onclick = async () => {
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();
      if (!email || !password) return showError('–í–≤–µ–¥—ñ—Ç—å email —ñ –ø–∞—Ä–æ–ª—å');

      try {
        const data = await apiRequest('/login', 'POST', { email, password });
        if (data.token) {
          localStorage.setItem('token', data.token);

          const payload = JSON.parse(atob(data.token.split('.')[1]));
          localStorage.setItem('role', payload.isAdmin ? 'admin' : 'user');
          window.location.href = 'index.html';
        }
      } catch (e) {
        showError(e.message);
      }
    };

  </script>

</body>
</html>